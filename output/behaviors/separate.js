// Generated by CoffeeScript 1.3.3
var Separate;

Separate = (function() {

  function Separate(options) {
    core.extend(this, core.defaults(options || {}, {
      enabled: true,
      agents: [],
      radius: 200,
      weight: 1.0,
      chance: 1.0
    }));
  }

  Separate.prototype.apply = function(agent) {
    var desired, distSq, other, radii, radiiSq, steer, _i, _len, _ref;
    if (!this.enabled || this.chance < 1 && Math.random() > this.chance) {
      return;
    }
    steer = new Vector();
    _ref = this.agents;
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      other = _ref[_i];
      if (!(other !== agent)) {
        continue;
      }
      radii = this.radius + agent.radius + other.radius;
      radiiSq = radii * radii;
      distSq = Vector.distSq(agent, other);
      if (distSq > 0 && distSq < radiiSq) {
        desired = Vector.sub(agent, other);
        desired.norm();
        desired.scale(utils.map(distSq, radiiSq, 0, 0, agent.maxSpeed));
        steer.add(desired);
      }
    }
    steer.scale(this.weight);
    return agent.acc.add(steer);
  };

  return Separate;

})();
